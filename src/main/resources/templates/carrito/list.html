<!--
================================================================================
CARRITO DE COMPRAS - carrito/list.html
================================================================================
Vista que muestra el carrito de compras del usuario con todos sus items.

MODELO ESPERADO (CarritoView):
- cantidadItems: Integer - Numero total de items
- totalCarritoFormateado: String - Total formateado "S/ 1,500.00"
- items: List<CarritoItemView> - Items del carrito

Cada CarritoItemView contiene:
- idItem: Integer
- nombrePaquete, nombreDestino: String
- fechaViajeInicioFormateada: String
- fechaInicioPaquete, fechaFinPaquete: String
- subtotalFormateado: String
- serviciosAdicionales: List<ServicioAdicionalItemView>

FLASH ATTRIBUTES:
- successMessage: Mensaje de operacion exitosa
- errorMessage: Mensaje de error

URL: /carrito
CONTROLADOR: CarritoWebController.verCarrito()

ACCIONES DISPONIBLES:
- Eliminar item: POST /carrito/eliminar/{idItem}
- Confirmar reservas: POST /carrito/checkout
- Vaciar carrito: POST /carrito/vaciar
================================================================================
-->

<section class="max-w-7xl mx-auto px-6 py-10">

    <!-- ═══════════════════════════════════════════════════════════════════════
         NAVEGACION - Breadcrumb
    ═══════════════════════════════════════════════════════════════════════ -->
    <nav class="mb-6 text-sm text-gray-500">
        <a th:href="@{/}" class="hover:text-red-600">Inicio</a>
        <span class="mx-2">/</span>
        <span class="text-gray-700">Mi Carrito</span>
    </nav>

    <!-- ═══════════════════════════════════════════════════════════════════════
         CABECERA - Titulo y contador de items
    ═══════════════════════════════════════════════════════════════════════ -->
    <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-bold">Mi Carrito de Compras</h2>
        <span th:if="${carrito.cantidadItems > 0}" class="text-gray-500">
            <span th:text="${carrito.cantidadItems}">0</span> item(s)
        </span>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════════
         MENSAJES DE FEEDBACK (Flash messages)
    ═══════════════════════════════════════════════════════════════════════ -->
    <div th:if="${successMessage}" class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg">
        <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════════
         ESTADO VACIO - Cuando el carrito no tiene items
    ═══════════════════════════════════════════════════════════════════════ -->
    <div th:if="${carrito.items == null or carrito.items.isEmpty()}" class="text-center py-16">
        <svg class="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
        </svg>
        <h3 class="text-xl font-medium text-gray-700 mb-2">Tu carrito esta vacio</h3>
        <p class="text-gray-500 mb-6">Agrega paquetes de viaje para comenzar</p>
        <a th:href="@{/paquetes}" class="inline-block bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition">
            Ver Paquetes
        </a>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════════
         CONTENIDO DEL CARRITO - Grid de 3 columnas
         Columnas 1-2: Lista de items
         Columna 3: Resumen del pedido
    ═══════════════════════════════════════════════════════════════════════ -->
    <div th:if="${carrito.items != null and !carrito.items.isEmpty()}" class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- ═══════════════════════════════════════════════════════════════════
             COLUMNA IZQUIERDA (2/3): Lista de items del carrito
        ═══════════════════════════════════════════════════════════════════ -->
        <div class="lg:col-span-2 space-y-4">

            <!-- Iteracion sobre cada item del carrito -->
            <div th:each="item : ${carrito.items}" class="bg-white rounded-lg shadow-md p-6 border">
                <div class="flex flex-col md:flex-row gap-4">

                    <!-- Imagen del paquete -->
                    <div class="md:w-1/4">
                        <img th:src="@{/img/hero_3.jpg}" th:alt="${item.nombrePaquete}"
                             class="rounded-lg w-full h-32 object-cover">
                    </div>

                    <!-- Informacion del paquete -->
                    <div class="md:w-2/4 flex-grow">
                        <h3 class="text-lg font-bold text-gray-800" th:text="${item.nombrePaquete}">Nombre Paquete</h3>
                        <p class="text-sm text-gray-500 mb-2">
                            <span th:text="${item.nombreDestino}">Destino</span>
                        </p>

                        <div class="text-sm text-gray-600 space-y-1">
                            <p>
                                <span class="font-medium">Fecha de viaje:</span>
                                <span th:text="${item.fechaViajeInicioFormateada}">00/00/0000</span>
                            </p>
                            <p>
                                <span class="font-medium">Paquete:</span>
                                <span th:text="${item.fechaInicioPaquete}">00/00/0000</span> -
                                <span th:text="${item.fechaFinPaquete}">00/00/0000</span>
                            </p>
                        </div>

                        <!-- Servicios adicionales del item (si existen) -->
                        <div th:if="${item.serviciosAdicionales != null and !item.serviciosAdicionales.isEmpty()}"
                             class="mt-3">
                            <p class="text-sm font-medium text-gray-700 mb-1">Servicios adicionales:</p>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li th:each="servicio : ${item.serviciosAdicionales}" class="flex justify-between">
                                    <span>
                                        <span th:text="${servicio.nombreServicio}">Servicio</span>
                                        <span class="text-gray-400">x<span th:text="${servicio.cantidad}">1</span></span>
                                    </span>
                                    <span th:text="${servicio.subtotalFormateado}" class="text-gray-600">S/ 0.00</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Precio y boton eliminar -->
                    <div class="md:w-1/4 flex flex-col items-end justify-between">
                        <div class="text-right">
                            <p class="text-sm text-gray-500">Subtotal</p>
                            <p class="text-xl font-bold text-red-600" th:text="${item.subtotalFormateado}">S/ 0.00</p>
                        </div>

                        <!-- Boton eliminar item -->
                        <form th:action="@{/carrito/eliminar/{id}(id=${item.idItem})}" method="post" class="mt-4">
                            <button type="submit" class="text-red-600 hover:text-red-800 text-sm flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                Eliminar
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             COLUMNA DERECHA (1/3): Resumen del pedido
             Card sticky que sigue al usuario durante el scroll
        ═══════════════════════════════════════════════════════════════════ -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-md p-6 border sticky top-6">
                <h3 class="text-lg font-bold mb-4 pb-4 border-b">Resumen del pedido</h3>

                <!-- Desglose de items -->
                <div class="space-y-3 mb-6">
                    <div class="flex justify-between text-gray-600">
                        <span>Items (<span th:text="${carrito.cantidadItems}">0</span>)</span>
                        <span th:text="${carrito.totalCarritoFormateado}">S/ 0.00</span>
                    </div>
                </div>

                <!-- Total -->
                <div class="border-t pt-4 mb-6">
                    <div class="flex justify-between text-lg font-bold">
                        <span>Total</span>
                        <span class="text-red-600" th:text="${carrito.totalCarritoFormateado}">S/ 0.00</span>
                    </div>
                </div>

                <!-- Botones de accion -->
                <div class="space-y-3">
                    <!-- Confirmar reservas (accion principal) -->
                    <form th:action="@{/carrito/checkout}" method="post">
                        <button type="submit" class="w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition font-medium">
                            Confirmar Reservas
                        </button>
                    </form>

                    <!-- Seguir comprando -->
                    <a th:href="@{/paquetes}" class="block w-full text-center border border-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-50 transition">
                        Seguir comprando
                    </a>

                    <!-- Vaciar carrito (accion destructiva) -->
                    <form th:action="@{/carrito/vaciar}" method="post">
                        <button type="submit" class="w-full text-red-600 hover:text-red-800 text-sm py-2">
                            Vaciar carrito
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

</section>
