<!-- Fragmentos Comunes para Admin -->
<!--
    Este archivo contiene fragmentos reutilizables para las vistas de administracion.
    Facilita el mantenimiento y asegura consistencia visual.
-->
<div xmlns:th="http://www.thymeleaf.org">

    <!-- Header de pagina con titulo y boton de accion -->
    <!--
        Uso: th:replace="~{fragments/admin-common :: pageHeader(titulo='Gestion de Usuarios', subtitulo='Administra los usuarios del sistema', btnUrl='/admin/usuarios/nuevo', btnTexto='Nuevo Usuario')}"
    -->
    <div th:fragment="pageHeader(titulo, subtitulo, btnUrl, btnTexto)"
         class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
        <div>
            <h2 class="text-xl font-semibold text-gray-800" th:text="${titulo}">Titulo</h2>
            <p class="text-gray-500 text-sm" th:text="${subtitulo}">Subtitulo</p>
        </div>
        <a th:href="@{${btnUrl}}" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            <span th:text="${btnTexto}">Nuevo</span>
        </a>
    </div>

    <!-- Contenedor de tabla -->
    <!--
        Uso: th:replace="~{fragments/admin-common :: tableContainer}"
        Luego insertar la tabla dentro
    -->
    <div th:fragment="tableContainer" class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <th:block th:insert="~{::tableContent}" />
    </div>

    <!-- Fila de tabla vacia -->
    <!--
        Uso: th:replace="~{fragments/admin-common :: emptyRow(colspan=7, mensaje='No hay registros')}"
    -->
    <tr th:fragment="emptyRow(colspan, mensaje)" class="text-center">
        <td th:colspan="${colspan}" class="px-6 py-8 text-gray-500" th:text="${mensaje}">No hay registros</td>
    </tr>

    <!-- Contenedor de paginacion -->
    <!--
        Uso: th:replace="~{fragments/admin-common :: paginationContainer(baseUrl='/admin/usuarios', currentPage=${currentPage}, totalPages=${totalPages}, filtroEstado=${filtroEstado}, filtroBusqueda=${filtroBusqueda})}"
    -->
    <div th:fragment="paginationContainer(baseUrl, currentPage, totalPages, filtroEstado, filtroBusqueda)"
         class="mt-6 flex justify-center">
        <nav class="flex items-center space-x-1">
            <!-- Boton Anterior -->
            <a th:href="@{${baseUrl}(page=${currentPage - 1}, estado=${filtroEstado}, busqueda=${filtroBusqueda})}"
               th:classappend="${currentPage == 0} ? 'pointer-events-none opacity-50' : ''"
               class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                Anterior
            </a>

            <!-- Numeros de pagina -->
            <th:block th:if="${totalPages > 0}" th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                <a th:href="@{${baseUrl}(page=${i}, estado=${filtroEstado}, busqueda=${filtroBusqueda})}"
                   th:classappend="${i == currentPage} ? 'bg-red-600 text-white border-red-600' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'"
                   class="px-3 py-2 text-sm font-medium border rounded-lg"
                   th:text="${i + 1}">1</a>
            </th:block>

            <!-- Pagina 1 cuando no hay paginas -->
            <a th:if="${totalPages == 0}"
               class="px-3 py-2 text-sm font-medium border rounded-lg bg-red-600 text-white border-red-600">1</a>

            <!-- Boton Siguiente -->
            <a th:href="@{${baseUrl}(page=${currentPage + 1}, estado=${filtroEstado}, busqueda=${filtroBusqueda})}"
               th:classappend="${currentPage + 1 >= totalPages} ? 'pointer-events-none opacity-50' : ''"
               class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                Siguiente
            </a>
        </nav>
    </div>

    <!-- Script de toggle estado generico -->
    <!--
        Uso: th:replace="~{fragments/admin-common :: toggleScript}"
        El boton debe tener data-id, data-estado y data-entity
    -->
    <script th:fragment="toggleScript" th:inline="javascript">
        function toggleEstado(btn) {
            const id = btn.dataset.id;
            const estado = btn.dataset.estado;
            const entity = btn.dataset.entity || 'registro';
            const nuevoEstado = estado === 'ACT' ? 'INA' : 'ACT';
            const accion = estado === 'ACT' ? 'desactivar' : 'activar';

            // Mapeo de entidades a endpoints
            const endpoints = {
                'usuario': '/api/v1/admin/usuarios',
                'destino': '/api/v1/admin/destinos',
                'paquete': '/api/v1/admin/paquetes',
                'servicio': '/api/v1/admin/servicios'
            };

            const baseUrl = endpoints[entity] || `/api/v1/admin/${entity}s`;

            if (confirm(`Â¿Estas seguro de ${accion} este ${entity}?`)) {
                fetch(`${baseUrl}/${id}/estado`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ estado: nuevoEstado })
                })
                .then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Error al cambiar el estado');
                    }
                });
            }
        }
    </script>

    <!-- Precio formateado -->
    <!--
        Uso: th:replace="~{fragments/admin-common :: precio(valor=${item.precio})}"
    -->
    <span th:fragment="precio(valor)"
          class="text-sm font-medium text-red-600"
          th:text="'S/ ' + ${#numbers.formatDecimal(valor, 1, 2)}">S/ 0.00</span>

    <!-- Badge de stock -->
    <!--
        Uso: th:replace="~{fragments/admin-common :: stockBadge(stock=${item.stockDisponible})}"
    -->
    <span th:fragment="stockBadge(stock)"
          th:class="'px-2 py-1 text-xs font-medium rounded-full ' +
              (${stock > 5} ? 'bg-green-100 text-green-800' :
              (${stock > 0} ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'))"
          th:text="${stock}">0</span>

    <!-- Boton de editar -->
    <!--
        Uso: th:replace="~{fragments/admin-common :: editButton(url='/admin/usuarios/' + ${item.id} + '/editar')}"
    -->
    <a th:fragment="editButton(url)"
       th:href="@{${url}}"
       class="text-blue-600 hover:text-blue-800">Editar</a>

</div>
