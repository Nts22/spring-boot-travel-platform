<!-- Paquetes List -->
<main class="flex-1 p-6" xmlns:th="http://www.thymeleaf.org">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
        <div>
            <h2 class="text-xl font-semibold text-gray-800">Gestion de Paquetes</h2>
            <p class="text-gray-500 text-sm">Administra los paquetes turisticos</p>
        </div>
        <a href="/admin/paquetes/nuevo" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            Nuevo Paquete
        </a>
    </div>

    <!-- Filtros -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6">
        <form th:action="@{/admin/paquetes}" method="GET" class="flex flex-col sm:flex-row gap-4">
            <div class="flex-1">
                <input type="text" name="busqueda" th:value="${filtroBusqueda}"
                       placeholder="Buscar por nombre de paquete o destino..."
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
            </div>
            <div class="sm:w-40">
                <select name="estado" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
                    <option value="">Todos los estados</option>
                    <option value="ACT" th:selected="${filtroEstado == 'ACT'}">Activo</option>
                    <option value="INA" th:selected="${filtroEstado == 'INA'}">Inactivo</option>
                </select>
            </div>
            <div class="flex gap-2">
                <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors">
                    Filtrar
                </button>
                <a th:href="@{/admin/paquetes}" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors">
                    Limpiar
                </a>
            </div>
        </form>
    </div>

    <!-- Tabla de Paquetes -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Destino</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fechas</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <tr th:if="${#lists.isEmpty(paquetes)}" class="text-center">
                    <td colspan="8" class="px-6 py-8 text-gray-500">No hay paquetes registrados</td>
                </tr>
                <tr th:each="paquete : ${paquetes}" class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${paquete.idPaquete}">1</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900" th:text="${paquete.nombre}">Nombre</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" th:text="${paquete.destino?.nombre}">Destino</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <span th:text="${#temporals.format(paquete.fechaInicio, 'dd/MM/yyyy')}">01/01/2024</span>
                        -
                        <span th:text="${#temporals.format(paquete.fechaFin, 'dd/MM/yyyy')}">05/01/2024</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600" th:text="'S/ ' + ${#numbers.formatDecimal(paquete.precio, 1, 2)}">S/ 0.00</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span th:class="'px-2 py-1 text-xs font-medium rounded-full ' +
                            (${paquete.stockDisponible > 5} ? 'bg-green-100 text-green-800' :
                            (${paquete.stockDisponible > 0} ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'))"
                            th:text="${paquete.stockDisponible}">0</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span th:class="'px-2 py-1 text-xs font-medium rounded-full ' +
                            (${paquete.estado == 'ACT'} ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800')"
                            th:text="${paquete.estado == 'ACT'} ? 'Activo' : 'Inactivo'">Activo</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                        <a th:href="@{/admin/paquetes/{id}/editar(id=${paquete.idPaquete})}"
                           class="text-blue-600 hover:text-blue-800">Editar</a>
                        <button type="button"
                                th:data-id="${paquete.idPaquete}"
                                th:data-estado="${paquete.estado}"
                                onclick="toggleEstado(this)"
                                th:class="(${paquete.estado == 'ACT'} ? 'text-red-600 hover:text-red-800' : 'text-green-600 hover:text-green-800')"
                                th:text="${paquete.estado == 'ACT'} ? 'Desactivar' : 'Activar'">Toggle</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Paginación -->
    <div class="mt-6 flex justify-center">
        <nav class="flex items-center space-x-1">
            <a th:href="@{/admin/paquetes(page=${currentPage - 1}, estado=${filtroEstado}, busqueda=${filtroBusqueda})}"
               th:classappend="${currentPage == 0} ? 'pointer-events-none opacity-50' : ''"
               class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                Anterior
            </a>
            <th:block th:if="${totalPages > 0}" th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                <a th:href="@{/admin/paquetes(page=${i}, estado=${filtroEstado}, busqueda=${filtroBusqueda})}"
                   th:classappend="${i == currentPage} ? 'bg-red-600 text-white border-red-600' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'"
                   class="px-3 py-2 text-sm font-medium border rounded-lg"
                   th:text="${i + 1}">1</a>
            </th:block>
            <a th:if="${totalPages == 0}" class="px-3 py-2 text-sm font-medium border rounded-lg bg-red-600 text-white border-red-600">1</a>
            <a th:href="@{/admin/paquetes(page=${currentPage + 1}, estado=${filtroEstado}, busqueda=${filtroBusqueda})}"
               th:classappend="${currentPage + 1 >= totalPages} ? 'pointer-events-none opacity-50' : ''"
               class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                Siguiente
            </a>
        </nav>
    </div>
</main>

<script th:inline="javascript">
    function toggleEstado(btn) {
        const id = btn.dataset.id;
        const estado = btn.dataset.estado;
        const nuevoEstado = estado === 'ACT' ? 'INA' : 'ACT';
        const accion = estado === 'ACT' ? 'desactivar' : 'activar';

        if (confirm(`¿Estás seguro de ${accion} este paquete?`)) {
            fetch(`/api/v1/admin/paquetes/${id}/estado`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ estado: nuevoEstado })
            })
            .then(response => {
                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Error al cambiar el estado');
                }
            });
        }
    }
</script>
